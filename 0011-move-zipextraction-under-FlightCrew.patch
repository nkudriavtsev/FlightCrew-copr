From 2f89daf591ff1a02a69f6902692754c343f47c2c Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Dan=20Hor=C3=A1k?= <dan@danny.cz>
Date: Wed, 19 Mar 2014 10:37:15 +0100
Subject: [PATCH 11/12] move zipextraction under FlightCrew

Move the zipextraction() function under FlightCrew directly as a preparation
for unbundling the zipios++ library.
---
 src/FlightCrew/Framework/ValidateEpub.cpp |  2 +-
 src/FlightCrew/Misc/zipextraction.cpp     | 78 ++++++++++++++++++++++++++++
 src/FlightCrew/Misc/zipextraction.h       | 35 +++++++++++++
 src/zipios/src/zipextraction.cpp          | 84 -------------------------------
 src/zipios/zipios++/zipextraction.h       | 35 -------------
 5 files changed, 114 insertions(+), 120 deletions(-)
 create mode 100644 src/FlightCrew/Misc/zipextraction.cpp
 create mode 100644 src/FlightCrew/Misc/zipextraction.h
 delete mode 100644 src/zipios/src/zipextraction.cpp
 delete mode 100644 src/zipios/zipios++/zipextraction.h

diff --git a/src/FlightCrew/Framework/ValidateEpub.cpp b/src/FlightCrew/Framework/ValidateEpub.cpp
index bc1024a..24ab443 100644
--- a/src/FlightCrew/Framework/ValidateEpub.cpp
+++ b/src/FlightCrew/Framework/ValidateEpub.cpp
@@ -22,7 +22,7 @@
 #include <stdafx.h>
 #include <vector>
 #include "Result.h"
-#include <zipios++/zipextraction.h>
+#include "Misc/zipextraction.h"
 #include "Misc/TempFolder.h"
 #include "Misc/Utilities.h"
 #include "Validators/Xml/WellFormedXml.h"
diff --git a/src/FlightCrew/Misc/zipextraction.cpp b/src/FlightCrew/Misc/zipextraction.cpp
new file mode 100644
index 0000000..45dc494
--- /dev/null
+++ b/src/FlightCrew/Misc/zipextraction.cpp
@@ -0,0 +1,78 @@
+/************************************************************************
+**
+**  Copyright (C) 2010  Strahinja Markovic
+**
+**  This file is part of FlightCrew.
+**
+**  FlightCrew is free software: you can redistribute it and/or modify
+**  it under the terms of the GNU Lesser General Public License as published
+**  by the Free Software Foundation, either version 3 of the License, or
+**  (at your option) any later version.
+**
+**  FlightCrew is distributed in the hope that it will be useful,
+**  but WITHOUT ANY WARRANTY; without even the implied warranty of
+**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+**  GNU Lesser General Public License for more details.
+**
+**  You should have received a copy of the GNU Lesser General Public License
+**  along with FlightCrew.  If not, see <http://www.gnu.org/licenses/>.
+**
+*************************************************************************/
+
+#include <memory>
+#include <stdlib.h>
+#include <boost/scoped_ptr.hpp>
+
+#include <zipios++/zipfile.h>
+#include "Misc/zipextraction.h"
+
+namespace zipios 
+{
+
+
+void WriteEntryToFile( const std::istream &stream, const fs::path &filepath )
+{
+    fs::ofstream ofs( filepath, ios::out | ios::binary );
+    ofs << stream.rdbuf();
+    ofs.close();
+}
+
+
+void CreateFilepath( const fs::path &filepath )
+{
+    if ( filepath.empty() )
+
+        throw IOException();
+
+    if ( !fs::exists( filepath.parent_path() ) )
+
+        fs::create_directories( filepath.parent_path() );
+
+    if ( fs::is_regular_file( filepath ) )
+    
+        fs::ofstream( filepath );
+
+    else if ( fs::is_directory( filepath ) )
+
+        fs::create_directory( filepath );
+}
+
+
+void ExtractZipToFolder( const fs::path &path_to_zip, const fs::path &path_to_folder )
+{
+    ZipFile zip( path_to_zip );
+
+    ConstEntries entries = zip.entries();
+    for ( ConstEntries::iterator it = entries.begin(); it != entries.end(); ++it )
+    {
+        boost::scoped_ptr< std::istream > stream( zip.getInputStream( *it ) );
+
+        fs::path new_file_path = path_to_folder / (*it)->getName();
+
+        CreateFilepath( new_file_path );
+        WriteEntryToFile( *stream, new_file_path );
+    }
+}
+
+
+} // namespace zipios
diff --git a/src/FlightCrew/Misc/zipextraction.h b/src/FlightCrew/Misc/zipextraction.h
new file mode 100644
index 0000000..20e909f
--- /dev/null
+++ b/src/FlightCrew/Misc/zipextraction.h
@@ -0,0 +1,35 @@
+/************************************************************************
+**
+**  Copyright (C) 2010  Strahinja Markovic
+**
+**  This file is part of FlightCrew.
+**
+**  FlightCrew is free software: you can redistribute it and/or modify
+**  it under the terms of the GNU Lesser General Public License as published
+**  by the Free Software Foundation, either version 3 of the License, or
+**  (at your option) any later version.
+**
+**  FlightCrew is distributed in the hope that it will be useful,
+**  but WITHOUT ANY WARRANTY; without even the implied warranty of
+**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+**  GNU Lesser General Public License for more details.
+**
+**  You should have received a copy of the GNU Lesser General Public License
+**  along with FlightCrew.  If not, see <http://www.gnu.org/licenses/>.
+**
+*************************************************************************/
+
+#pragma once
+#ifndef ZIPEXTRACTION_H
+#define ZIPEXTRACTION_H
+
+#include "Misc/BoostFilesystemUse.h"
+
+namespace zipios 
+{
+    void ExtractZipToFolder( const fs::path &path_to_zip, const fs::path &path_to_folder );
+
+} // namespace zipios
+
+
+#endif // ZIPEXTRACTION_H
\ No newline at end of file
diff --git a/src/zipios/src/zipextraction.cpp b/src/zipios/src/zipextraction.cpp
deleted file mode 100644
index 8541625..0000000
--- a/src/zipios/src/zipextraction.cpp
+++ /dev/null
@@ -1,84 +0,0 @@
-/************************************************************************
-**
-**  Copyright (C) 2010  Strahinja Markovic
-**
-**  This file is part of FlightCrew.
-**
-**  FlightCrew is free software: you can redistribute it and/or modify
-**  it under the terms of the GNU Lesser General Public License as published
-**  by the Free Software Foundation, either version 3 of the License, or
-**  (at your option) any later version.
-**
-**  FlightCrew is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU Lesser General Public License for more details.
-**
-**  You should have received a copy of the GNU Lesser General Public License
-**  along with FlightCrew.  If not, see <http://www.gnu.org/licenses/>.
-**
-*************************************************************************/
-
-#include "zipios++/zipios-config.h"
-
-#include "zipios++/meta-iostreams.h"
-#include <memory>
-#include <stdlib.h>
-#include <boost/scoped_ptr.hpp>
-
-#include "zipios++/zipfile.h"
-#include "zipios++/zipinputstream.h"
-
-#include "zipios++/zipextraction.h"
-#include "zipios++/fcollexceptions.h"
-
-namespace zipios 
-{
-
-
-void WriteEntryToFile( const std::istream &stream, const fs::path &filepath )
-{
-    fs::ofstream ofs( filepath, ios::out | ios::binary );
-    ofs << stream.rdbuf();
-    ofs.close();
-}
-
-
-void CreateFilepath( const fs::path &filepath )
-{
-    if ( filepath.empty() )
-
-        throw IOException();
-
-    if ( !fs::exists( filepath.parent_path() ) )
-
-        fs::create_directories( filepath.parent_path() );
-
-    if ( fs::is_regular_file( filepath ) )
-    
-        fs::ofstream( filepath );
-
-    else if ( fs::is_directory( filepath ) )
-
-        fs::create_directory( filepath );
-}
-
-
-void ExtractZipToFolder( const fs::path &path_to_zip, const fs::path &path_to_folder )
-{
-    ZipFile zip( path_to_zip );
-
-    ConstEntries entries = zip.entries();
-    for ( ConstEntries::iterator it = entries.begin(); it != entries.end(); ++it )
-    {
-        boost::scoped_ptr< std::istream > stream( zip.getInputStream( *it ) );
-
-        fs::path new_file_path = path_to_folder / (*it)->getName();
-
-        CreateFilepath( new_file_path );
-        WriteEntryToFile( *stream, new_file_path );
-    }
-}
-
-
-} // namespace zipios
diff --git a/src/zipios/zipios++/zipextraction.h b/src/zipios/zipios++/zipextraction.h
deleted file mode 100644
index c90a75c..0000000
--- a/src/zipios/zipios++/zipextraction.h
+++ /dev/null
@@ -1,35 +0,0 @@
-/************************************************************************
-**
-**  Copyright (C) 2010  Strahinja Markovic
-**
-**  This file is part of FlightCrew.
-**
-**  FlightCrew is free software: you can redistribute it and/or modify
-**  it under the terms of the GNU Lesser General Public License as published
-**  by the Free Software Foundation, either version 3 of the License, or
-**  (at your option) any later version.
-**
-**  FlightCrew is distributed in the hope that it will be useful,
-**  but WITHOUT ANY WARRANTY; without even the implied warranty of
-**  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-**  GNU Lesser General Public License for more details.
-**
-**  You should have received a copy of the GNU Lesser General Public License
-**  along with FlightCrew.  If not, see <http://www.gnu.org/licenses/>.
-**
-*************************************************************************/
-
-#pragma once
-#ifndef ZIPEXTRACTION_H
-#define ZIPEXTRACTION_H
-
-#include "../../FlightCrew/Misc/BoostFilesystemUse.h"
-
-namespace zipios 
-{
-    void ExtractZipToFolder( const fs::path &path_to_zip, const fs::path &path_to_folder );
-
-} // namespace zipios
-
-
-#endif // ZIPEXTRACTION_H
\ No newline at end of file
-- 
1.8.5.3

